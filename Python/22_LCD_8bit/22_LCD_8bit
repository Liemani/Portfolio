# title = "22_LCD_8bit"
# made by Lieman at 2020.06.18
#
# description:
#   LCD example





# import
import RPi.GPIO as GPIO
import time





# class
class LCD:
    def __init__(self):
        self.characterPinArray = []
        self.controlPinArray = []
    
    def setCharaterPin(self, *pinArray):
        for pin in pinArray:
            self.characterPinArray.append(pin)
            GPIO.setup(pin, GPIO.OUT, initial = GPIO.LOW)
    
    def setControlPin(self, *pinArray):
        for pin in pinArray:
            self.controlPinArray.append(pin)
            GPIO.setup(pin, GPIO.OUT, initial = GPIO.LOW)
    
    def initializeDevice(self):
        time.sleep(0.04)
        
        GPIO.output(self.controlPinArray[0], GPIO.LOW)
        GPIO.output(self.controlPinArray[1], GPIO.LOW)
        self.exportData(0x30, 0.0005)
        self.exportData(0x30, 0.0002)
        self.exportData(0x30)
        
        self.exportData(0x38)
        self.exportData(0x08)
        self.exportData(0x01)
        self.exportData(0x04)
    
    def exportData(self, data, duration = 0):
        for i in range(0, 8):
            GPIO.output(self.characterPinArray[i], data >> i & 0x1)
        
        GPIO.output(self.controlPinArray[2], GPIO.HIGH)
        time.sleep(duration)
        GPIO.output(self.controlPinArray[2], GPIO.LOW)
    
    def exportCharacter(self, data, duration = 0):
        for i in range(0, 8):
            GPIO.output(self.characterPinArray[i], data >> i & 0x1)
        
        GPIO.output(self.controlPinArray[0], GPIO.HIGH)
        time.sleep(duration)
        GPIO.output(self.controlPinArray[0], GPIO.LOW)





# function





# main
GPIO.setmode(GPIO.BOARD)

characterPinArray = [21, 22, 23, 24, 31, 33, 35, 37, ]
controlPinArray = [11, 13, 16, 18, ]

lcd = LCD()
lcd.setCharaterPin(*characterPinArray)
lcd.setControlPin(*controlPinArray)
lcd.initializeDevice()

try:
    lcd.exportCharacter(0x41)
    
    while True:
        time.sleep(10000)

except KeyboardInterrupt:
    print("KeyboardInterrupt occured")

finally:
    for pin in lcd.characterPinArray + lcd.controlPinArray:
        GPIO.output(pin, GPIO.LOW)
    GPIO.cleanup()
    print("terminated")


